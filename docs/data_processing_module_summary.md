# modules/data_processing_module.py åˆ†ææ€»ç»“

**åˆ†æå®Œæˆæ—¥æœŸ**: 2025-10-28  
**åˆ†æç»“è®º**: âœ… **å¯ä»¥åˆ é™¤**

---

## ğŸ“Š å¿«é€Ÿæ¦‚è§ˆ

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| **æ–‡ä»¶å¤§å°** | 1600è¡Œ |
| **æ—§æ¶æ„ä»£ç ** | ~800è¡Œ (50%) |
| **å…±ç”¨ä»£ç ** | ~25è¡Œ (1.5%) |
| **åˆ é™¤åä»£ç å‡å°‘** | ~1575è¡Œ |
| **é£é™©ç­‰çº§** | ğŸŸ¢ ä½ |
| **å·¥ä½œé‡** | ~1å°æ—¶ |

---

## ğŸ” å…³é”®å‘ç°

### 1. æ–°æ¶æ„å®Œå…¨ç‹¬ç«‹
âœ… æ–°æ¶æ„ï¼ˆmodules/core/ï¼‰**ä¸ä¾èµ–** `data_processing_module.py`
- æ‰€æœ‰æ•°æ®å¤„ç†é€»è¾‘å·²é‡å†™
- æ‰€æœ‰å¥–åŠ±è®¡ç®—é€»è¾‘å·²é‡å†™
- æ‰€æœ‰é€šçŸ¥é€»è¾‘å·²é‡å†™

### 2. ä»…æœ‰ä¸€ä¸ªå…±ç”¨å‡½æ•°
âœ… åªæœ‰ `should_enable_badge()` å‡½æ•°è¢«æ–°æ¶æ„ä½¿ç”¨
- ä½ç½®: ç¬¬86-105è¡Œ
- ä»£ç é‡: ~20è¡Œ
- ç”¨é€”: æ£€æŸ¥æ˜¯å¦å¯ç”¨å¾½ç« åŠŸèƒ½
- ä½¿ç”¨ä½ç½®:
  - `modules/core/notification_service.py` ç¬¬341è¡Œ
  - `modules/notification_module.py` ç¬¬55è¡Œ

### 3. æ—§æ¶æ„å‡½æ•°å·²åˆ é™¤
âŒ æ‰€æœ‰æ—§æ¶æ„ä¸“ç”¨å‡½æ•°å·²ä» jobs.py ä¸­åˆ é™¤
- `process_data_jun_beijing()` - å·²åˆ é™¤
- `process_data_shanghai_apr()` - å·²åˆ é™¤
- `process_data_shanghai_sep()` - å·²åˆ é™¤
- `process_data_sep_beijing()` - å·²åˆ é™¤

### 4. æ–°æ¶æ„æœ‰ç­‰ä»·å®ç°
âœ… æ–°æ¶æ„ä¸­å·²æœ‰æ‰€æœ‰åŠŸèƒ½çš„ç­‰ä»·å®ç°
- å¹¸è¿æ•°å­—å¥–åŠ±: `RewardCalculator._determine_lucky_number_reward()`
- è‡ªå¼•å•å¥–åŠ±: `RewardCalculator._determine_self_referral_reward()`
- èŠ‚èŠ‚é«˜å¥–åŠ±: `RewardCalculator._calculate_tiered_rewards()`

---

## ğŸ“‹ å‡½æ•°åˆ†ç±»

### å¿…é¡»ä¿ç•™çš„å‡½æ•°
```python
âœ… should_enable_badge()  # 20è¡Œ - è¢«æ–°æ¶æ„ä½¿ç”¨
```

### å¯ä»¥åˆ é™¤çš„å‡½æ•°
```python
âŒ determine_lucky_number_reward()              # å·²è¢«æ–°æ¶æ„æ›¿ä»£
âŒ determine_lucky_number_reward_generic()      # å·²è¢«æ–°æ¶æ„æ›¿ä»£
âŒ determine_rewards_generic()                  # å·²è¢«æ–°æ¶æ„æ›¿ä»£
âŒ determine_rewards_jun_beijing_generic()      # å·²è¢«æ–°æ¶æ„æ›¿ä»£
âŒ determine_rewards_sep_beijing_generic()      # å·²è¢«æ–°æ¶æ„æ›¿ä»£
âŒ determine_rewards_apr_shanghai_generic()     # å·²è¢«æ–°æ¶æ„æ›¿ä»£
âŒ determine_rewards_sep_shanghai_generic()     # å·²è¢«æ–°æ¶æ„æ›¿ä»£
âŒ get_self_referral_config()                   # å·²è¢«æ–°æ¶æ„æ›¿ä»£
âŒ determine_self_referral_rewards()            # å·²è¢«æ–°æ¶æ„æ›¿ä»£
âŒ process_data_jun_beijing()                   # æ—§æ¶æ„ä¸“ç”¨
âŒ process_data_shanghai_apr()                  # æ—§æ¶æ„ä¸“ç”¨
âŒ process_data_shanghai_sep()                  # æ—§æ¶æ„ä¸“ç”¨
âŒ process_data_sep_beijing()                   # æ—§æ¶æ„ä¸“ç”¨
âŒ is_historical_contract()                     # æ—§æ¶æ„ä¸“ç”¨
âŒ process_historical_contract()                # æ—§æ¶æ„ä¸“ç”¨
âŒ process_historical_contract_with_project_limit() # æ—§æ¶æ„ä¸“ç”¨
âŒ [ä»¥åŠå…¶ä»–~30ä¸ªå‡½æ•°]
```

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### æ–¹æ¡ˆ: å®Œå…¨åˆ é™¤ + å‡½æ•°æå–

**æ­¥éª¤**:
1. å°† `should_enable_badge()` æå–åˆ° `modules/data_utils.py`
2. æ›´æ–°å¯¼å…¥è¯­å¥ï¼ˆ2ä¸ªæ–‡ä»¶ï¼‰
3. åˆ é™¤ `modules/data_processing_module.py`
4. è¿è¡Œæµ‹è¯•éªŒè¯

**ä¼˜ç‚¹**:
- âœ… ä»£ç è¡Œæ•°å‡å°‘ ~1575è¡Œ
- âœ… æ¶ˆé™¤é‡å¤ä»£ç 
- âœ… ç®€åŒ–ç»´æŠ¤
- âœ… é£é™©æä½

**ç¼ºç‚¹**:
- éœ€è¦æ›´æ–°2ä¸ªå¯¼å…¥è¯­å¥

**å·¥ä½œé‡**: ~1å°æ—¶

---

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### ä»£ç è´¨é‡
- ä»£ç è¡Œæ•°å‡å°‘ ~1575è¡Œ (98%)
- æ¶ˆé™¤é‡å¤ä»£ç 
- æ¨¡å—èŒè´£æ›´æ¸…æ™°

### ç»´æŠ¤æˆæœ¬
- å‡å°‘ç»´æŠ¤çš„æ–‡ä»¶æ•°
- å‡å°‘ä»£ç å®¡æŸ¥æ—¶é—´
- å‡å°‘æ–°å¼€å‘è€…å­¦ä¹ æˆæœ¬

### ç³»ç»Ÿæ€§èƒ½
- å‡å°‘æ¨¡å—åŠ è½½æ—¶é—´
- å‡å°‘å†…å­˜å ç”¨
- åŠ å¿«å¯¼å…¥é€Ÿåº¦

---

## âš ï¸ é£é™©è¯„ä¼°

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| é—æ¼å…±ç”¨å‡½æ•° | æä½ | ä¸­ | è¯¦ç»†æ£€æŸ¥å¯¼å…¥ |
| å¯¼å…¥è·¯å¾„é”™è¯¯ | æä½ | ä¸­ | è¿è¡Œæµ‹è¯• |
| æ–°æ¶æ„åŠŸèƒ½å—å½±å“ | æä½ | é«˜ | å®Œæ•´æµ‹è¯• |

**æ€»ä½“é£é™©**: ğŸŸ¢ **ä½**

---

## âœ… éªŒè¯æ¸…å•

åˆ é™¤å‰éªŒè¯:
- [ ] ç¡®è®¤æ–°æ¶æ„jobå¯æ­£å¸¸å¯¼å…¥
- [ ] ç¡®è®¤å…±ç”¨å‡½æ•°å·²è¯†åˆ«
- [ ] ç¡®è®¤æ²¡æœ‰å…¶ä»–æ–‡ä»¶ä¾èµ–æ—§æ¨¡å—

åˆ é™¤åéªŒè¯:
- [ ] æ–°æ¶æ„jobå¯æ­£å¸¸å¯¼å…¥
- [ ] å…±ç”¨å‡½æ•°å¯æ­£å¸¸å¯¼å…¥
- [ ] é€šçŸ¥æœåŠ¡å¯æ­£å¸¸å¯¼å…¥
- [ ] æ—§æ¨¡å—å·²åˆ é™¤
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- ğŸ“„ [è¯¦ç»†åˆ†æ](data_processing_module_analysis.md)
- ğŸ“„ [æ‰§è¡Œè®¡åˆ’](data_processing_module_removal_plan.md)
- ğŸ“„ [æ—§æ¶æ„ç§»é™¤è®¡åˆ’](legacy_architecture_removal_plan.md)

---

## ğŸš€ å»ºè®®

### ç«‹å³æ‰§è¡Œ
âœ… æŒ‰ç…§æ‰§è¡Œè®¡åˆ’åˆ é™¤ `modules/data_processing_module.py`

### åç»­ä¼˜åŒ–
1. è€ƒè™‘å°†å…¶ä»–å…±ç”¨å‡½æ•°ä¹Ÿæå–åˆ° `modules/data_utils.py`
2. è€ƒè™‘åˆ é™¤ `modules/notification_module.py`ï¼ˆå¦‚æœæ–°æ¶æ„å®Œå…¨æ›¿ä»£ï¼‰
3. è€ƒè™‘æ¸…ç†å…¶ä»–æ—§æ¶æ„é—ç•™ä»£ç 

---

## ğŸ“ é—®é¢˜æ’æŸ¥

### é—®é¢˜1: å¯¼å…¥é”™è¯¯
```
ModuleNotFoundError: No module named 'modules.data_processing_module'
```
**è§£å†³**: æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶ä»åœ¨å¯¼å…¥æ—§æ¨¡å—ï¼Œæ›´æ–°å¯¼å…¥è¯­å¥

### é—®é¢˜2: å‡½æ•°æœªæ‰¾åˆ°
```
AttributeError: module 'modules.data_utils' has no attribute 'should_enable_badge'
```
**è§£å†³**: ç¡®è®¤ `should_enable_badge()` å·²æ·»åŠ åˆ° `modules/data_utils.py`

### é—®é¢˜3: æµ‹è¯•å¤±è´¥
```
AssertionError: ...
```
**è§£å†³**: è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ä¾èµ–

---

## ğŸ“ æ‰§è¡Œè®°å½•

| æ—¥æœŸ | æ“ä½œ | çŠ¶æ€ |
|------|------|------|
| 2025-10-28 | å®Œæˆåˆ†æ | âœ… |
| å¾…æ‰§è¡Œ | æå–å‡½æ•° | â³ |
| å¾…æ‰§è¡Œ | æ›´æ–°å¯¼å…¥ | â³ |
| å¾…æ‰§è¡Œ | åˆ é™¤æ–‡ä»¶ | â³ |
| å¾…æ‰§è¡Œ | è¿è¡Œæµ‹è¯• | â³ |
| å¾…æ‰§è¡Œ | æäº¤ä»£ç  | â³ |

---

## ğŸ‰ æ€»ç»“

âœ… **modules/data_processing_module.py å¯ä»¥å®‰å…¨åˆ é™¤**

- æ–°æ¶æ„å®Œå…¨ç‹¬ç«‹
- ä»…éœ€æå–1ä¸ªå…±ç”¨å‡½æ•°
- é£é™©æä½
- æ”¶ç›Šæ˜¾è‘—
- å·¥ä½œé‡å°

**å»ºè®®**: ç«‹å³æ‰§è¡Œåˆ é™¤æ“ä½œ

