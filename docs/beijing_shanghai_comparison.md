# 北京与上海业务对比文档

## 1. 数据源对比

| 项目 | 北京 | 上海 |
|------|------|------|
| **API端点** | `/api/card/1864/query` | `/api/card/1838/query` |
| **管家标识格式** | `管家` | `管家_服务商` |
| **数据字段数量** | 23个字段 | 22个字段 |
| **特殊字段** | `pcContractdocNum`（历史合同编号） | 无 |

### 共同数据字段
- 合同ID、活动城市、工单编号、管家、服务商
- 合同金额、支付金额、差额、状态、创建时间
- 签约时间、款项来源类型、工单类型、项目地址等

## 2. 9月活动规则对比

| 规则项目 | 北京9月 | 上海9月 |
|----------|---------|---------|
| **幸运数字** | 5（个人序号倍数） | 无 |
| **合同门槛** | 10个合同 | 5个合同 |
| **工单金额上限** | 5万元 | 无上限 |
| **合同金额上限** | 5万元 | 无上限 |
| **双轨统计** | 不支持 | 支持（平台单/自引单） |
| **历史合同** | 支持 | 不支持 |

### 奖励对比

| 奖励类型 | 北京9月 | 上海9月 |
|----------|---------|---------|
| **幸运奖** | 接好运 58元 | 无 |
| **基础奖** | 无 | 4万业绩 200元 |
| **达标奖** | 8万业绩 400元 | 6万业绩 300元 |
| **优秀奖** | 18万业绩 800元 | 8万业绩 400元 |
| **精英奖** | 28万业绩 1600元 | 12万业绩 800元 |
| **卓越奖** | 无 | 16万业绩 1200元 |
| **自引单奖** | 无 | 红包 50元 |

## 3. 新架构技术实现对比

| 技术项目 | 北京9月 | 上海9月 |
|----------|---------|---------|
| **配置键** | `BJ-2025-09` | `SH-2025-09` |
| **活动编码** | `BJ-SEP` | `SH-SEP` |
| **管家格式** | `管家` | `管家_服务商` |
| **工单金额上限** | 启用（5万） | 禁用 |
| **合同金额上限** | 启用（5万） | 禁用 |
| **双轨统计** | 禁用 | 启用 |
| **历史合同** | 启用 | 禁用 |
| **CSV输出** | 禁用 | 禁用 |

### 处理管道配置

| 配置项 | 北京9月 | 上海9月 |
|--------|---------|---------|
| **存储类型** | SQLite | SQLite |
| **幸运数字模式** | 个人序号 | 无 |
| **项目地址去重** | 禁用 | 启用（仅自引单） |
| **奖励历史检查** | 启用 | 启用 |

### 关键差异说明

1. **北京特色**：支持历史合同处理，启用工单/合同金额上限，使用个人序号幸运数字
2. **上海特色**：支持双轨统计（平台单/自引单），无金额限制，项目地址去重，奖励层级更多
3. **共同特性**：使用SQLite存储，支持奖励历史检查

## 4. 数据处理流程差异

| 处理步骤 | 北京9月 | 上海9月 |
|----------|---------|---------|
| **数据获取** | Metabase API（23字段） | Metabase API（22字段） |
| **历史合同** | 获取并处理 | 跳过 |
| **金额上限** | 工单/合同5万上限 | 不限制 |
| **订单分类** | 仅平台单 | 平台单+自引单 |
| **项目地址去重** | 不处理 | 自引单去重 |
| **奖励计算** | 单轨+幸运数字 | 双轨+自引单奖励 |
| **输出格式** | 标准CSV | 双轨CSV |

---

*文档生成时间：2025-09-23*  
*对应代码版本：production-db-v2分支*
